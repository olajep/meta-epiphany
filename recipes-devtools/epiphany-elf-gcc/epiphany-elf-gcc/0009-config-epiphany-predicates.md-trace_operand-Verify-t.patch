From 6ba8a607058c71908fa3c6874781a0c6f2631336 Mon Sep 17 00:00:00 2001
From: Joern Rennecke <joern.rennecke@embecosm.com>
Date: Fri, 2 Aug 2013 04:56:30 +0100
Subject: [PATCH 09/33] * config/epiphany/predicates.md (trace_operand): Verify
 that address is a PLUS or REG.

---
 gcc/ChangeLog.epiphany            | 3 +++
 gcc/config/epiphany/predicates.md | 4 +++-
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/gcc/ChangeLog.epiphany b/gcc/ChangeLog.epiphany
index a34fa66c806..c21364e97c0 100644
--- a/gcc/ChangeLog.epiphany
+++ b/gcc/ChangeLog.epiphany
@@ -11,6 +11,9 @@
 	(epiphany_emit_save_restore): Don't worry about last_saved if
 	reg_size is aligned.
 
+	* config/epiphany/predicates.md (trace_operand): Verify that address
+	is a PLUS or REG.
+
 2013-08-01  Joern Rennecke <joern.rennecke@embecosm.com>
 
 	* config/epiphany/epiphany.h (FIRST_PSEUDO_REGISTER): Bump up to 79.
diff --git a/gcc/config/epiphany/predicates.md b/gcc/config/epiphany/predicates.md
index 6eb135cbd19..406e767d19b 100644
--- a/gcc/config/epiphany/predicates.md
+++ b/gcc/config/epiphany/predicates.md
@@ -55,7 +55,9 @@
 })
 
 (define_predicate "trace_operand"
-  (match_code "mem"))
+  (and (match_code "mem")
+       (match_test "GET_CODE (XEXP (op, 0)) == PLUS
+		    || GET_CODE (XEXP (op, 0)) == REG")))
 
 ;; general purpose register.
 (define_predicate "gpr_operand"
-- 
2.31.1

